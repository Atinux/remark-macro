!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):n.remarkMacro=r()}(this,function(){"use strict";function n(n,r){n.key&&(r[n.key]=n.value,n.key="",n.value="")}var r=function(r){for(var e=r.split(""),t={},o={key:"",value:""},i="key",a=!1,f="";e.length;){var u=e.shift(),c=u.charCodeAt(0);34===c&&(!e[0]||[32,44].indexOf(e[0].charCodeAt(0))>-1)?a=!1:a?o[i]+=u:34===c&&[32,61].indexOf(f)>-1?a=!0:32===c||(61===c?i="value":44===c?(i="key",n(o,t)):o[i]+=u),f=c}return n(o,t),t},e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t=function n(r,e,t,i,a){var f=null!==i&&void 0!==i;var u=null!==t&&void 0!==t;var c=o(r);if(u&&("number"!=typeof t||t<0||t===1/0))throw new Error("Expected positive finite index or child node");if(f&&(!n(null,i)||!i.children))throw new Error("Expected parent node");if(!e||!e.type||"string"!=typeof e.type)return!1;if(f!==u)throw new Error("Expected both parent and index");return Boolean(c.call(a,e,t,i))};function o(n){if("string"==typeof n)return function(n){return function(r){return Boolean(r&&r.type===n)}}(n);if(null===n||void 0===n)return i;if("object"===(void 0===n?"undefined":e(n)))return("length"in n?function(n){var r=function(n){var r=[],e=n.length,t=-1;for(;++t<e;)r[t]=o(n[t]);return r}(n),e=r.length;return function(){var n=-1;for(;++n<e;)if(r[n].apply(this,arguments))return!0;return!1}}:function(n){return function(r){var e;for(e in n)if(r[e]!==n[e])return!1;return!0}})(n);if("function"==typeof n)return n;throw new Error("Expected function, string, or object as test")}function i(){return!0}var a=l,f=!0,u="skip",c=!1;function l(n,r,e,o){function i(n,a,l){var p;return a=a||(l?0:null),r&&n.type!==r&&!t(r,n,a,l||null)||(p=e(n,a,l||null)),p===c?p:n.children&&p!==u&&function(n,r){var e,t,a=o?-1:1,u=(o?n.length:-1)+a;for(;u>-1&&u<n.length;){if(e=n[u],(t=e&&i(e,u,r))===c)return t;u="number"==typeof t?t:u+a}return f}(n.children,n)===c?c:p}"function"==typeof r&&"function"!=typeof e&&(o=e,e=r,r=null),i(n)}l.CONTINUE=f,l.SKIP=u,l.EXIT=c;var p=/^(\s{2})?\[(\w+)(.*)?\](?!\()\n?/;function s(n){return{type:"BadMacroNode",data:{hName:"div",hChildren:[{type:"text",value:n}]}}}function d(n,r){a(n,"BadMacroNode",function(n){r.message(n.data.hChildren[0].value,n.position.start)})}return function(){var n={};function e(e,t,o){if(t.trim().startsWith("[")){var i=p.exec(t);if(i&&0===i.index&&!o){var a=i[0],f=void 0===i[1]?"":i[1],u=i[2].trim(),c=i[3],l=n[u];if(l){var d={transformer:this,eat:e,badNode:s};return l.inline?function(n,e,t,o){var i=t.$,a=(t.spaces,t.macroName,t.macro),f=t.props,u=f?r(f):{},c=a.fn(u,o);c?n(i)(c):n(i)}(e,0,{$:a,spaces:f,macroName:u,props:c,macro:l},d):function(n,e,t,o){for(var i=t.$,a=t.spaces,f=t.macroName,u=t.macro,c=t.props,l=!1,p=[],d=[],h=e.split("\n");h.length;){var y=h.shift();if(p.push(y),""+y==a+"[/"+f+"]"){l=!0;break}y.startsWith(a+"["+f)||d.push(y.replace(a,""))}if(l){var m=c?r(c):{},v=u.fn(d.join("\n"),m,o);v?n(p.join("\n"))(v):n(p.join("\n"))}else n(i)(s("Unclosed macro: "+f))}(e,t,{$:a,spaces:f,macroName:u,props:c,macro:l},d)}}}}return{addMacro:function(r,e,t){if(n[r])throw new Error("Cannot redefine the macro "+r+". One already exists");if("function"!=typeof e)throw new Error("addMacro expects 2nd argument to be a function");return n[r]={fn:e,inline:t||!1},this},transformer:function(){var n=this.Parser.prototype,r=n.blockMethods,t=n.blockTokenizers;return r.splice(r.indexOf("paragraph"),0,"macro"),t.macro=e,d}}}});
